{% extends "main.html" %}

{% block content %}
<br>
<h3><strong>Agenda de turnos</strong></h3>
<hr>
<!-- Contenedor del calendario -->
<div id='calendar'></div>

<!-- Modal para mostrar los detalles del turno -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="eventModalLabel">ðŸ“… Detalles del Turno</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row mb-3">
            <div class="col-4 fw-bold">Cliente:</div>
            <div class="col-8" id="cliente"></div>
          </div>
          <div class="row mb-3">
            <div class="col-4 fw-bold">Solicitante:</div>
            <div class="col-8" id="solicitante"></div>
          </div>
          <div class="row mb-3">
            <div class="col-4 fw-bold">Motivo:</div>
            <div class="col-8" id="motivo"></div>
          </div>
          <hr>
          <div class="row mb-3">
            <div class="col-4 fw-bold">Fecha:</div>
            <div class="col-8" id="fecha"></div>
          </div>
          <div class="row mb-3">
            <div class="col-4 fw-bold">Hora:</div>
            <div class="col-8" id="hora"></div>
          </div>
          <div class="row mb-3">
            <div class="col-4 fw-bold">Profesional:</div>
            <div class="col-8" id="profesional"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- FullCalendar JavaScript y archivo de localizaciÃ³n en espaÃ±ol -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/locales/es.global.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      locale: 'es',
      initialView: 'dayGridMonth',
      events: '/turnos/turnos-json/',
      eventClick: function(info) {
        const startDate = info.event.start;
        const endDate = info.event.end;

        const dateString = startDate.toLocaleDateString('es-ES', { year: 'numeric', month: 'numeric', day: 'numeric' });
        const startTimeString = startDate.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
        const endTimeString = endDate ? endDate.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }) : '';

        document.getElementById('cliente').textContent = info.event.extendedProps.cliente;
        document.getElementById('solicitante').textContent = info.event.extendedProps.solicitante;
        document.getElementById('motivo').textContent = info.event.extendedProps.motivo;
        document.getElementById('fecha').textContent = dateString;
        document.getElementById('hora').textContent = `${startTimeString} - ${endTimeString}`;
        document.getElementById('profesional').textContent = info.event.extendedProps.professional;

        const eventModal = new bootstrap.Modal(document.getElementById('eventModal'));
        eventModal.show();
      }
    });
    calendar.render();
  });
</script>
{% endblock content %}
